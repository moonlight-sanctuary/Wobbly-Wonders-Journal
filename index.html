<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ Reflect - Personal Journal</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- Google Analytics - Privacy-First Implementation -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LZ91EBZEH6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // Configure with maximum privacy settings
        gtag('config', 'G-LZ91EBZEH6', {
            // Privacy-first configuration
            anonymize_ip: true,           // Anonymize IP addresses
            allow_google_signals: false,  // Disable Google Signals
            allow_ad_personalization_signals: false, // Disable ad personalization
            restricted_data_processing: true, // Enable restricted data processing
            
            // Content protection
            custom_map: {},               // No custom dimensions that could leak content
            send_page_view: true,         // Only basic page views
            
            // Additional privacy settings
            storage: 'none',              // Minimize cookie usage
            client_storage: 'none'        // Disable client storage
        });
        
        // Explicitly disable automatic form tracking
        gtag('config', 'G-LZ91EBZEH6', {
            send_page_view: false  // We'll manually control what gets sent
        });
        
        // Send only the initial page load
        gtag('event', 'page_view', {
            page_title: 'Reflect Journal',
            page_location: window.location.href,
            // NO content data included
        });
    </script>
</head>
<body>


    <!-- Sidebar Toggles -->
    <button class="sidebar-toggle left-toggle" id="leftToggle">â€¹</button>
    <button class="sidebar-toggle right-toggle" id="rightToggle">â€º</button>

    <!-- Left Sidebar -->
    <div class="sidebar left-sidebar" id="leftSidebar">
        <div class="sidebar-header">
            <h3>Previous Entries</h3>
        </div>
        <input type="text" id="searchInput" placeholder="Search your thoughts..." class="search-input">
        <div class="template-filter">
            <button class="filter-tab active" data-filter="all">All Entries</button>
            <button class="filter-tab" data-filter="templates">Templates (<span id="templateCount">0</span>/5)</button>
        </div>
        <div class="entry-list" id="entryList">
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">ğŸ“</div>
                <p>No entries yet</p>
                <span>Start writing to see your entries here</span>
            </div>
        </div>
    </div>

    <!-- Right Sidebar -->
    <div class="sidebar right-sidebar" id="rightSidebar">
        <div class="sidebar-header">
            <h3>Tools</h3>
        </div>
        <div class="tools">
            <div class="new-entry-container">
                <button id="newBtn" class="tool-btn primary">
                    <span class="tool-icon">âœ¨</span>
                    <span>New Entry</span>
                </button>
                <button id="templateDropdownBtn" class="template-dropdown-btn" aria-label="Choose template" aria-expanded="false">
                    <span class="dropdown-arrow">â–¼</span>
                </button>
                <div id="newEntryDropdown" class="new-entry-dropdown" style="display: none;" role="menu">
                    <!-- Dropdown options will be populated by JavaScript -->
                </div>
            </div>
            <button id="exportBtn" class="tool-btn">
                <span class="tool-icon">ğŸ“¥</span>
                <span>Export Journal</span>
            </button>
            <button id="importBtn" class="tool-btn">
                <span class="tool-icon">ğŸ“¤</span>
                <span>Import Journal</span>
            </button>
            <input type="file" id="importFile" accept=".json" style="display: none;">
            
            <!-- AI Tools Section -->
            <div class="ai-tools-section">
                <div class="section-divider"></div>
                <h4 class="section-title">AI Assistant</h4>
                
                <button id="aiChatBtn" class="tool-btn ai-btn">
                    <span class="tool-icon">ğŸ’­</span>
                    <span>Chat with AI</span>
                </button>
                
                <div class="ai-status" id="aiStatus">
                    <div class="status-indicator"></div>
                    <span>AI: Checking...</span>
                </div>
                
                <div class="ai-capabilities" id="aiCapabilities" style="display: none;">
                    <div class="capability-item">ğŸ’­ Chat about your entries</div>
                    <div class="capability-item">ğŸ” Explore themes and patterns</div>
                    <div class="capability-item">ğŸ’¡ Get insights and perspectives</div>
                </div>
            </div>
            
            <!-- AI Model Selector -->
            <div class="section-divider"></div>
            <h4 class="section-title">AI Model</h4>
            <div class="model-selector" id="modelSelector">
                <div class="current-model" id="currentModel">
                    <div class="model-info">
                        <div class="model-name">Loading...</div>
                        <div class="model-description">Checking available models</div>
                    </div>
                    <button class="model-dropdown-btn" id="modelDropdownBtn">âŒ„</button>
                </div>
                <div class="model-dropdown" id="modelDropdown" style="display: none;">
                    <!-- Model options will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Theme Selector -->
            <div class="section-divider"></div>
            <h4 class="section-title">Appearance</h4>
            <div class="theme-selector" id="themeSelector">
                <div class="theme-options" id="themeOptions">
                    <!-- Theme cards will be generated by JavaScript -->
                </div>
                <div class="mode-toggle" id="modeToggle">
                    <button class="mode-btn light active" data-mode="light">â˜€ï¸ Light</button>
                    <button class="mode-btn dark" data-mode="dark">ğŸŒ™ Dark</button>
                </div>
            </div>
            
            <!-- Template Management Section -->
            <div class="section-divider"></div>
            <h4 class="section-title">Templates</h4>
            <div class="template-management" id="templateManagement">
                <div class="template-count" id="templateCountDisplay">
                    <span id="templateCountText">0 of 5 slots used</span>
                </div>
                <div id="templateListContainer">
                    <!-- Template list will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Test Panel Integration -->
            <div class="section-divider"></div>
            <button id="testToggleBtn" class="tool-btn">
                <span class="tool-icon">ğŸ§ª</span>
                <span>Run Tests</span>
            </button>
            <div id="testPanel" class="test-panel-sidebar" style="display: none;"></div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="writing-container">
            <textarea id="journalEntry" placeholder="Welcome to âœ¨ Reflect - Your Personal Journal

This is your private space for thoughts and reflections. Everything you write is automatically saved to your browser and stays completely private on your device.

âœ¨ AI Features (powered by Ollama running locally):
â€¢ Chat with AI about your journal entries and patterns
â€¢ Get insights and perspectives on your writing
â€¢ Explore themes across your reflections
â€¢ All AI processing happens on your computer

ğŸ“ Getting Started:
â€¢ Just start typing - your entries auto-save as you write
â€¢ Use the sidebar buttons (â€¹ â€º) to access previous entries and tools
â€¢ Click 'Chat with AI' to reflect on your entries
â€¢ Switch themes and AI models in the right sidebar
â€¢ Your data never leaves your device

ğŸ”’ Privacy Notice:
â€¢ We use privacy-first analytics to understand feature usage
â€¢ NO journal content, chat messages, or personal data is ever collected
â€¢ Only basic interactions (clicks, page loads) are tracked anonymously
â€¢ All your writing stays completely private on your device

Go ahead and start writing about your day, thoughts, or anything on your mind..."></textarea>
            <div class="bottom-status-bar">
                <div class="autosave-indicator">
                    <div class="autosave-status">
                        <div class="autosave-dot" id="autosaveDot"></div>
                        <span id="autosaveStatus">Saved</span>
                    </div>
                    <span id="lastSavedTime"></span>
                </div>
                <div class="word-count" id="wordCount">0 words</div>
            </div>

        </div>
    </main>

    <!-- Floating AI Chat Interface -->
    <div class="floating-ai-chat" id="floatingAIChat" style="display: none;">
        <div class="chat-header">
            <h4>ğŸ’­ Reflect with AI</h4>
            <button class="chat-close-btn" id="chatCloseBtn" title="Close chat">Ã—</button>
        </div>
        <div class="chat-disclaimer">
            <small>ğŸ’¡ This conversation isn't saved - it's just for reflection in the moment</small>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-welcome">
                <p>I can help you explore your journal entries and identify patterns in your thinking.</p>
                <p>Ask me about specific entries, themes across your writing, or insights from your reflections.</p>
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="chatInput" placeholder="Ask about your current entry or journal..." class="chat-input">
            <button id="chatSendBtn" class="chat-send-btn">Send</button>
        </div>
        <div class="chat-actions" id="chatActions" style="display: none;">
            <button id="createReflectionBtn" class="chat-action-btn">
                <span class="action-icon">âœ¨</span>
                <span>Create new entry for reflection</span>
            </button>
        </div>
    </div>

    <!-- Floating New Entry Button -->
    <button id="floatingNewBtn" class="floating-new-btn" title="New Entry">
        <span class="floating-btn-text">New Entry</span>
    </button>

    <script src="app.js"></script>
    <script src="test-framework.js"></script>
</body>
</html>